name: learn-github-actions
on:
  pull_request:
    types: [assigned, opened, synchronize, reopened]
jobs:
  cppcheck:
    runs-on: ubuntu-latest
    steps:
      - run: sudo apt-get update -y
      - run: sudo apt-get install -y cppcheck
      - run: cppcheck main.c parallel.c consistent.c
  build:
    runs-on: ubuntu-latest
    steps:
      - run: sudo apt-get update -y
      - run: sudo apt-get install -y cppcheck
      - run: cmake -B build
      - run: cd build
      - run: make main_consistent
      - run: make main_parallel
      - run: make tests_gcovr_cons
      - run: make tests_gcovr_parall
  unit_tests: # plus valgrind gcovr
    runs-on: ubuntu-latest
    needs: [build]
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
      - run: npm install -g bats
      - run: bats -v
  stress_test:
    runs-on: ubuntu-latest
    needs: [build]
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
      - run: npm install -g bats
      - run: bats -v
  # unit_tests:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #     - uses: actions/setup-node@v1
  #     - run: npm install -g bats
  #     - run: bats -v